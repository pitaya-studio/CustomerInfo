angular.module("qc.uploader",["qc"]).provider("qcUploader",function(){this.options={thumb:{width:110,height:110,quality:100,allowMagnify:!0,crop:!1,type:"image/jpeg"},makeThumb:!1,swf:"/src/components/webuploader/Uploader.swf",server:"http://192.168.130.4:3000/files/uploading",auto:!0,resize:!1},this.$get=["$timeout",function(a){var b=this.options,c=function(a){var c=WebUploader.create(angular.extend(b,a));return c};return{create:c}}]}).filter("fileSize",["$filter",function(a){return function(b,c){var d;switch(c.toUpperCase()){case"KB":d=parseFloat(b/1024);break;case"MB":d=parseFloat(b/1024/1024);break;default:d=0}return a("number")(d,2)+" "+c}}]).directive("qcUploaderPicker",["qcUploader","qcFlashVersion","$window","$timeout",function(a,b,c,d){return{require:"^ngModel",restrict:"AE",scope:{qcUploaderOptions:"="},link:function(c,d,e,f){if(!b.installed)return c.$emit("qcUpload.flash.uninstall"),void d.html('<a class="flash-link"  href="https://get.adobe.com/cn/flashplayer" target="_blank">没安装flash</a>');if(b.version<"12")return c.$emit("qcUpload.flash.outdated"),void d.html('<a class="flash-link" href="https://get.adobe.com/cn/flashplayer" target="_blank">flash版本太低</a>');var g=angular.extend(c.qcUploaderOptions?c.qcUploaderOptions:{},{pick:d}),h=a.create(g);f.$setViewValue(h.getFiles()),h.on("fileQueued",function(a){f.$setViewValue(h.getFiles()),a.on("statuschange",function(b,c){a.status=b}),h.options.makeThumb&&h.makeThumb(a,function(b,d){c.$apply(function(){a.thumbSrc=d})},h.options.thumb.width,h.options.thumb.height)}),h.on("uploadError",function(a,b){a.errorMsg=b}),h.on("uploadProgress",function(a,b){var d=f.$modelValue.filter(function(b){return b.id===a.id});d.length&&c.$apply(function(){d[0].ProgressPercentage=b})}),h.on("uploadSuccess",function(a,b){var d=f.$modelValue.filter(function(b){return b.id===a.id});d.length&&c.$apply(function(){angular.extend(d[0],c.$eval(b._raw).data[0]),c.$emit("uploader.completed",d[0])})}),c.modelFiles=f.$modelValue,c.$on("uploader.removeFile",function(a,b){var c,d=h.getFiles();angular.forEach(d,function(a){a.id===b&&(c=a)}),h.removeFile(c,!0),f.$setViewValue(d)}),g.submitSelector&&$(g.submitSelector).on("click",function(){h.upload()})}}}]);
/*! M-tour 最后修改于： 2015-11-27 */